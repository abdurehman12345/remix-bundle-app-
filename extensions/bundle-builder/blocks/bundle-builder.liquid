{% schema %}
{
  "name": "Bundle Builder 3D",
  "target": "section",
  "stylesheet": "bundle.css",
  "javascript": "bundle.js",
  "settings": [
    
    {
      "type": "header",
      "content": "Bundle Configuration"
    },
    {
      "type": "text",
      "id": "bundle_id",
      "label": "Bundle ID",
      "info": "Leave empty to show all bundles"
    },
    {
      "type": "text",
      "id": "api_url",
      "label": "API URL",
      "default": "/apps/bundles",
      "info": "API endpoint for bundle data"
    },
    {
      "type": "header",
      "content": "3D Ring Carousel Settings"
    },
    {
      "type": "select",
      "id": "carousel_style",
      "label": "Carousel Style",
      "default": "coverflow",
      "options": [
        { "value": "coverflow", "label": "Coverflow (3D angled)" },
        { "value": "cube-modern", "label": "Cube (Modern)" },
        { "value": "flip", "label": "Flip" },
        { "value": "slide", "label": "Classic / Slide" },
        { "value": "motion", "label": "Center Pop (Custom)" }
      ],
      "info": "Pro: Advanced styles. Free plan will use Classic/Slide."
    },
    {
      "type": "checkbox",
      "id": "enable_3d_ring",
      "label": "Enable 3D Ring Carousel",
      "default": true,
      "info": "Display bundles in a rotating 3D ring formation"
    },
    {
      "type": "range",
      "id": "ring_radius",
      "min": 200,
      "max": 600,
      "step": 50,
      "unit": "px",
      "label": "Ring radius",
      "default": 400,
      "info": "Size of the 3D ring carousel"
    },
    {
      "type": "range",
      "id": "ring_tilt",
      "min": 0,
      "max": 30,
      "step": 5,
      "unit": "deg",
      "label": "Ring tilt angle",
      "default": 15,
      "info": "3D perspective tilt of the ring"
    },
    {
      "type": "checkbox",
      "id": "enable_autoplay",
      "label": "Enable autoplay",
      "default": true,
      "info": "Automatically rotate through bundles"
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "min": 2,
      "max": 10,
      "step": 1,
      "unit": "s",
      "label": "Autoplay speed",
      "default": 5,
      "info": "Time between automatic rotations"
    },
    {
      "type": "header",
      "content": "Visual Enhancements"
    },
    {
      "type": "checkbox",
      "id": "enable_glassmorphism",
      "label": "Enable glassmorphism effects",
      "default": true,
      "info": "Modern glass-like transparency effects"
    },
    {
      "type": "checkbox",
      "id": "show_floating_icons",
      "label": "Show floating decorative icons",
      "default": true,
      "info": "Animated floating icons in header"
    },
    {
      "type": "checkbox",
      "id": "show_progress_bar",
      "label": "Show progress indicator",
      "default": true,
      "info": "Display carousel progress bar"
    },
    {
      "type": "checkbox",
      "id": "enable_parallax",
      "label": "Enable parallax mouse effects",
      "default": true,
      "info": "Subtle 3D movement following mouse cursor"
    },
    {
      "type": "select",
      "id": "card_style",
      "label": "Card style",
      "options": [
        {
          "value": "modern",
          "label": "Modern Glassmorphism"
        },
        {
          "value": "premium",
          "label": "Premium Gradient"
        },
        {
          "value": "minimal",
          "label": "Minimal Clean"
        }
      ],
      "default": "modern",
      "info": "Choose the visual style for bundle cards"
    },
    {
      "type": "header",
      "content": "Interactive Features"
    },
    {
      "type": "checkbox",
      "id": "enable_haptic_feedback",
      "label": "Enable haptic feedback",
      "default": true,
      "info": "Vibration feedback on mobile devices"
    },
    {
      "type": "checkbox",
      "id": "show_discount_badges",
      "label": "Show animated discount badges",
      "default": true,
      "info": "Pulsing discount percentage badges"
    },
    {
      "type": "checkbox",
      "id": "enable_touch_gestures",
      "label": "Enhanced touch gestures",
      "default": true,
      "info": "Improved swipe and touch interactions"
    },
    {
      "type": "checkbox",
      "id": "show_bundle_stats",
      "label": "Show bundle statistics",
      "default": true,
      "info": "Display ratings, shipping info, etc."
    },
    {
      "type": "header",
      "content": "Performance & Accessibility"
    },
    {
      "type": "checkbox",
      "id": "reduced_motion_support",
      "label": "Respect reduced motion preference",
      "default": true,
      "info": "Disable animations for users who prefer reduced motion"
    },
    {
      "type": "checkbox",
      "id": "high_contrast_mode",
      "label": "High contrast mode support",
      "default": true,
      "info": "Enhanced contrast for better accessibility"
    },
    {
      "type": "checkbox",
      "id": "keyboard_navigation",
      "label": "Enhanced keyboard navigation",
      "default": true,
      "info": "Full keyboard control of the carousel"
    },
    {
      "type": "checkbox",
      "id": "preload_images",
      "label": "Preload bundle images",
      "default": true,
      "info": "Faster loading with image preloading"
    }
  ]
}
{% endschema %}

{%- comment -%}
Enhanced Bundle Builder Section - 3D Ring Carousel
Revolutionary 3D ring carousel with modern glassmorphism design
{%- endcomment -%}

{%- liquid
  assign s = section.settings

  assign bundle_id = s.bundle_id | strip
  assign api_url = s.api_url | default: '/apps/bundles'
  assign enable_3d_ring = s.enable_3d_ring
  assign ring_radius = s.ring_radius | default: 400
  assign ring_tilt = s.ring_tilt | default: 15
  assign enable_autoplay = s.enable_autoplay
  assign autoplay_speed = s.autoplay_speed | times: 1000
  assign hero_title = 'Premium Collection'
  assign hero_subtitle = 'Special bundles curated with care for our customers.'
  assign hero_emoji = 'üéÅ'
  assign hero_color_start = '#6366f1'
  assign hero_color_end = '#8b5cf6'
  assign hero_text_color = '#ffffff'
  assign enable_glassmorphism = s.enable_glassmorphism
  assign show_floating_icons = s.show_floating_icons
  assign show_progress = s.show_progress_bar
  assign enable_parallax = s.enable_parallax
  assign card_style = s.card_style | default: 'modern'
  assign enable_haptic = s.enable_haptic_feedback
  assign show_discount_badges = s.show_discount_badges
  assign enable_touch = s.enable_touch_gestures
  assign show_stats = s.show_bundle_stats
  assign reduced_motion = s.reduced_motion_support
  assign high_contrast = s.high_contrast_mode
  assign keyboard_nav = s.keyboard_navigation
  assign preload_images = s.preload_images
  assign carousel_style = s.carousel_style | default: 'coverflow'
-%}

{%- comment -%} Enhanced configuration script {%- endcomment -%}
<script>
  window.ENHANCED_BUNDLE_CONFIG = {
    sectionId: '{{ section.id }}',
    enable3DRing: {{ enable_3d_ring | json }},
    ringRadius: {{ ring_radius | json }},
    ringTilt: {{ ring_tilt | json }},
    heroTitle: {{ hero_title | json }},
    heroSubtitle: {{ hero_subtitle | json }},
    heroEmoji: {{ hero_emoji | json }},
    heroColorStart: {{ hero_color_start | json }},
    heroColorEnd: {{ hero_color_end | json }},
    heroTextColor: {{ hero_text_color | json }},
    glassmorphism: {{ enable_glassmorphism | json }},
    floatingIcons: {{ show_floating_icons | json }},
    progressBar: {{ show_progress | json }},
    parallax: {{ enable_parallax | json }},
    cardStyle: {{ card_style | json }},
    hapticFeedback: {{ enable_haptic | json }},
    discountBadges: {{ show_discount_badges | json }},
    touchGestures: {{ enable_touch | json }},
    bundleStats: {{ show_stats | json }},
    enableAutoplay: {{ enable_autoplay | json }},
    autoplaySpeed: {{ autoplay_speed | json }},
    reducedMotion: {{ reduced_motion | json }},
    keyboardNav: {{ keyboard_nav | json }},
    preloadImages: {{ preload_images | json }},
    carouselStyle: {{ carousel_style | json }}
  };
</script>

{%- comment -%} Dynamic CSS custom properties {%- endcomment -%}
<style>
  :root {
    --bb-ring-radius: {{ ring_radius }}px;
    --bb-ring-tilt: {{ ring_tilt }}deg;
    --bb-primary: {{ settings.colors_accent_1 | default: '#6366f1' }};
    --bb-primary-hover: {{ settings.colors_accent_1 | color_darken: 10 | default: '#4f46e5' }};
    --bb-text: {{ settings.colors_text | default: '#1f2937' }};
    --bb-background: {{ settings.colors_background_1 | default: '#ffffff' }};
    --bb-hero-start: {{ hero_color_start }};
    --bb-hero-end: {{ hero_color_end }};
    --bb-hero-text: {{ hero_text_color }};
  }
</style>

{%- comment -%} Override hero header colors using CSS variables {%- endcomment -%}
<style>
  .bb__header {
    background: linear-gradient(135deg, var(--bb-hero-start, var(--bb-primary)) 0%, var(--bb-hero-end, #8b5cf6) 100%);
    color: var(--bb-hero-text, var(--bb-white));
  }
</style>

{%- comment -%} Enhanced bundle builder container {%- endcomment -%}
<div 
  id="bundle-builder-{{ section.id }}" 
  class="enhanced-bundle-container bb-3d-ring"
  data-bundle-id="{{ bundle_id }}" 
  data-api-url="{{ api_url }}"
  data-enable-3d-ring="{{ enable_3d_ring }}"
  data-ring-radius="{{ ring_radius }}"
  data-ring-tilt="{{ ring_tilt }}"
  data-enable-autoplay="{{ enable_autoplay }}"
  data-autoplay-speed="{{ autoplay_speed }}"
  data-carousel-style="{{ carousel_style }}"
  data-touch-gestures="{{ enable_touch_gestures }}"
  data-keyboard-nav="{{ keyboard_nav }}"
  data-card-style="{{ card_style }}"
  data-section-id="{{ section.id }}"
  data-hero-title="{{ hero_title }}"
  data-hero-subtitle="{{ hero_subtitle }}"
  data-hero-emoji="{{ hero_emoji }}"
  data-hero-color-start="{{ hero_color_start }}"
  data-hero-color-end="{{ hero_color_end }}"
  data-hero-text-color="{{ hero_text_color }}"
  role="main"
  aria-label="Enhanced 3D Ring Bundle Builder Interface"
  {% if high_contrast %}data-high-contrast="true"{% endif %}
  {% if reduced_motion %}data-reduced-motion="true"{% endif %}
  {% if keyboard_nav %}data-keyboard-nav="true"{% endif %}
  {% if enable_glassmorphism %}data-glassmorphism="true"{% endif %}
  {% if enable_parallax %}data-parallax="true"{% endif %}>
  
  {%- comment -%} Enhanced loading state with 3D effects {%- endcomment -%}
  <div class="bb__loading bb__loading--3d" role="status" aria-live="polite">
    <div class="bb__loading-container">
      <div class="bb__loading-spinner bb__loading-spinner--3d" aria-hidden="true">
        <div class="bb__spinner-ring bb__spinner-ring--outer"></div>
        <div class="bb__spinner-ring bb__spinner-ring--middle"></div>
        <div class="bb__spinner-ring bb__spinner-ring--inner"></div>
        <div class="bb__spinner-core"></div>
      </div>
      <div class="bb__loading-content">
        <h3>Loading 3D Ring Collection</h3>
        <p>Preparing your immersive bundle experience...</p>
        <div class="bb__loading-progress">
          <div class="bb__progress-bar">
            <div class="bb__progress-fill bb__progress-fill--3d"></div>
          </div>
          <span class="bb__progress-text">Initializing 3D engine...</span>
        </div>
      </div>
    </div>
    <span class="sr-only">Please wait while we load your enhanced 3D ring carousel bundle interface.</span>
  </div>

  {%- comment -%} Floating action buttons with 3D effects {%- endcomment -%}
  <div class="bb__floating-actions bb__floating-actions--3d" aria-label="Quick actions">
    <button type="button" class="bb__fab bb__fab--help" aria-label="Help and support" title="Need help?">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"></circle>
        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
        <line x1="12" y1="17" x2="12.01" y2="17"></line>
      </svg>
    </button>
    <button type="button" class="bb__fab bb__fab--fullscreen" aria-label="Toggle fullscreen" title="Fullscreen mode">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>
      </svg>
    </button>
  </div>
</div>

{%- comment -%} Enhanced inline styles for 3D effects {%- endcomment -%}
{%- comment -%}
  NOTE: The following <style> block contains component-specific styles.
  For better performance and maintainability, these styles should be moved
  to the 'bundle.css' file associated with this section.
{%- endcomment -%}
<style>
  {%- comment -%} Screen reader only content {%- endcomment -%}
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }

  {%- comment -%} Focus management {%- endcomment -%}
  .enhanced-bundle-container:focus-within {
    outline: 3px solid var(--bb-primary);
    outline-offset: 2px;
  }

  .bb__fab:focus {
    outline: 3px solid #ffffff;
    outline-offset: 2px;
  }
</style>
{%- comment -%} Structured data for enhanced SEO {%- endcomment -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Product",
  "name": "Premium 3D Ring Collections",
  "description": "Revolutionary 3D ring carousel showcasing curated gift bundles with immersive depth, premium wrapping, personalized messages, and cutting-edge visual effects.",
  "category": "Interactive Gift Sets",
  "brand": {
    "@type": "Brand",
    "name": "{{ shop.name }}"
  },
  "offers": {
    "@type": "AggregateOffer",
    "priceCurrency": "{{ cart.currency.iso_code }}",
    "availability": "https://schema.org/InStock"
  },
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "4.9",
    "reviewCount": "{{ bundles.size | default: 50 }}"
  }
}
</script>
{%- comment -%} Preload critical resources for performance {%- endcomment -%}
<link rel="preload" href="{{ 'bundle.css' | asset_url }}" as="style">
<link rel="preload" href="{{ 'bundle.js' | asset_url }}" as="script">
{%- comment -%} Enhanced error boundary for JavaScript failures {%- endcomment -%}
<script src="{{ 'bundle.js' | asset_url }}" onerror="this.onerror=null;document.getElementById('bundle-builder-{{ section.id }}').innerHTML='<div class=bb__error><h3>Loading Error</h3><p>Unable to load bundle interface. Please refresh the page.</p></div>'"></script>

{%- comment -%} Accessibility announcements {%- endcomment -%}
<div aria-live="polite" aria-atomic="true" class="sr-only" id="bundle-announcements-{{ section.id }}">
  {%- comment -%} Dynamic announcements will be inserted here by JavaScript {%- endcomment -%}
</div>
{%- comment -%} Enhanced skip link for keyboard users {%- endcomment -%}
<a href="#bundle-content-{{ section.id }}" class="sr-only bb__skip-link">
  Skip to 3D bundle content
</a>
{%- comment -%} Main content anchor with enhanced accessibility {%- endcomment -%}
<div id="bundle-content-{{ section.id }}" tabindex="-1" aria-label="3D Ring bundle builder main content">
  {%- comment -%} Content will be dynamically inserted here by enhanced JavaScript {%- endcomment -%}
</div>
{%- comment -%} Performance monitoring {%- endcomment -%}
<script>
  // Track loading performance
  if (typeof performance !== 'undefined') {
    window.addEventListener('load', function() {
      const loadTime = performance.now();
      console.log(`Enhanced 3D Bundle Builder loaded in ${Math.round(loadTime)}ms`);
    });
  }
</script>